name: Fetch Latest Podcast Episodes

on:
  workflow_dispatch: # 允许手动运行
  schedule:
    # 按计划运行
    # 你的要求: 每周五 17:10 洛杉矶时间 (PST/UTC-8)
    # 我们把抓取时间提早1小时，设为 16:10 PST
    # 16:10 (周五) + 8 小时 = 24:10 (UTC)
    # 也就是 UTC 时间的 周六 凌晨 00:10
    - cron: '10 0 * * 6'

jobs:
  fetch:
    runs-on: ubuntu-latest
    steps:
      # 1. 检出代码
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2. 设置 Python 环境
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      # 3. 安装 Python 依赖库 (在 GitHub 服务器上)
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install feedparser PyYAML

      # 4. 运行更新脚本 (在 GitHub 服务器上)
      - name: Run update script
        run: python3 update_episodes.py

      # 5. 自动提交更改 (如果文件有变动)
      - name: Commit and push if data changed
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: 'CI: Update podcast episodes list (auto)'
          file_pattern: '_data/episodes.yml'
          commit_user_name: 'GitHub Actions Bot'
          commit_user_email: 'github-actions-bot@users.noreply.github.com'
          commit_author: 'GitHub Actions Bot <github-actions-bot@users.noreply.github.com>'